# AI 保险工具开发与设计总结

本文档总结了当前已实现的 AI 工具，以及针对“客户上下文感知”和“案例参考”功能的新设计方案。

## 1. 已实现的核心工具 (Active Tools)

目前系统集成了以下 5 个核心工具，用于处理产品搜索和客户档案更新：

| 工具名称 | 作用 | 重点特性 |
| :--- | :--- | :--- |
| `insurance_filter` | 精确筛选 | 支持按年龄、险种类型、保额区间进行硬性筛选。 |
| `insurance_search` | 语义搜索 | 对保险条款进行深度文本搜索，支持模糊匹配。 |
| `insurance_inspect` | 产品详情 | 获取特定产品的完整参数、保障内容、免责条款等。 |
| `update_client_intelligence` | 档案同步 | **核心功能**：对话中实时提取客户风险、需求，更新后端数据库。 |
| `submit_insurance_plan` | 方案提交 | 提交为特定客户量身定制的结构化保险方案（方案书）。 |

## 2. 待解决的问题：客户上下文感知

**现状**：
- 虽然前端已将会话（Session）与客户（Client）绑定，但 AI Agent 在对话开始时并不主动掌握该客户的背景信息。
- 如果对话中信息发生变更，AI 无法实时“感知”到数据库中的最新数据，除非重新传递。

## 3. 拟开发的新工具 (Proposed Tools)

为了让 AI 具备主动查询客户档案和参考历史案例的能力，设计以下 3 个新工具：

### 07. `get_current_client_profile` (当前客户感知)
- **描述**：获取当前对话绑定的客户完整全景档案。
- **参数**：无（由后端从会话链接中自动识别）。
- **作用**：AI 在需要制定方案前，可以先调用此工具查看客户的“风险点”、“家庭结构”和“过往记录”。

### 08. `get_client_profile` (跨客户查询)
- **描述**：通过 `client_id` 查询特定客户的信息。
- **作用**：用于 AI 检索历史成功案例。当销售人员问“以前有没有类似的成功方案？”时使用。

### 09. `search_similar_clients` (案例搜索)
- **描述**：根据画像特征（如：30岁、大厂员工、高保额需求）搜索类似的客户群体。
- **作用**：提供数据支持，让 AI 能够说出“根据我们服务过的 100 位类似客户，通常会选择...”

## 4. 架构优化建议 (Hybrid Approach)

1. **轻量级 System Prompt**：在会话开始时，仅告诉 AI 客户的姓名和核心标签（如：糯糯，30岁，预算5W）。
2. **工具化详情获取**：AI 只有在需要详细分析时（如计算保额、分析家庭保障缺口）才调用 `get_current_client_profile`。
3. **实时性保证**：由于 AI 每次分析都是调用工具，因此能完美解决“信息变了怎么办”的问题（每次调用拿到的都是数据库最新值）。
