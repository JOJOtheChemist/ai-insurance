# fs_write 工具使用指南

`fs_write` 是一个用于**创建**或**完全覆盖**文件的工具。

## 1. 核心功能

*   **创建新文件**：如果指定的 `path` 不存在，它会创建一个新文件（如果目录不存在，也会自动递归创建目录）。
*   **覆盖旧文件**：如果文件已存在，它会**删除原内容**并用你提供的 `content` 完全替换它。

### 与 fs_edit 的区别

*   `fs_edit` = 微创手术（局部修改）。
*   `fs_write` = 推倒重来（整体重写）。

## 2. 参数说明

| 参数名 | 类型 | 必填 | 说明 |
| :--- | :--- | :--- | :--- |
| `path` | string | **是** | 文件路径。必须在沙箱工作目录内。 |
| `content` | string | **是** | 要写入的完整文件内容。 |

## 3. 安全与冲突检测

`fs_write` 集成了 **FilePool** 服务，提供了一种基本的“新鲜度检查”机制（乐观锁）：

1.  **检查冲突**：在写入前，SDK 会检查该文件最近是否被外部程序修改过，且 Agent 自上次读取后是否未再次读取。
2.  **阻止覆盖**：如果发现文件可能“不新鲜”（stale），工具会返回错误：
    > `File appears to have changed externally. Please read it again before writing.`
3.  **解决方式**：如果遇到这个错误，Agent 需要先调用 `fs_read` 获取最新内容，然后再尝试写入。

## 4. 使用场景

### 4.1 创建新文件
这是最常用的场景。Agent 编写好代码后，将其保存为文件。

```json
{
  "path": "src/components/Button.tsx",
  "content": "import React from 'react';\n\nexport const Button = () => <button>Click me</button>;"
}
```

### 4.2 重置/清空文件
如果你想把一个配置文件恢复到初始状态，或者清空日志文件。

### 4.3 写入极小的文件
如果文件非常小（只有几行），直接用 `fs_write` 重写比用 `fs_edit` 做字符串替换更方便、更不容易出错。

## 5. 最佳实践

1.  **修改现有文件时慎用**：如果你只是想改一个函数，**不要**用 `fs_write` 把整个文件读出来再写回去。这样做有两个坏处：
    *   **上下文丢失**：你可能把文件里的其他部分（如注释、你不理解的代码）不小心改坏了。
    *   **Token 消耗**：对于大文件，重写整个内容会消耗大量 Token。
    *   **建议**：修改现有代码优先使用 `fs_edit`。
2.  **创建文件时放心用**：对于新文件，`fs_write` 是唯一选择。
3.  **注意目录**：你不需要担心目录是否存在，`fs_write` 底层会自动处理目录创建（`mkdir -p`）。
