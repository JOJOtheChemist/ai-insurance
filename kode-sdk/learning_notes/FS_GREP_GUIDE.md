# fs_grep 工具使用指南

`fs_grep` 是一个用于在文件内容中搜索特定文本模式的工具。它类似于命令行的 `grep`，但专门为 Agent 环境设计，并在沙箱中安全运行。

## 1. 搜索机制

`fs_grep` 的工作流程如下：

1.  **文件定位**：首先根据提供的 `path` 参数（可以是具体文件路径或 glob 通配符），找出所有需要扫描的目标文件。
2.  **正则构建**：
    *   如果 `regex` 为 `true`，直接使用输入的 `pattern` 构建正则表达式。
    *   如果 `regex` 为 `false`（默认），会将 `pattern` 中的特殊字符转义，将其视为普通字符串进行精确匹配。
    *   根据 `case_sensitive` 参数决定是否区分大小写。
3.  **内容扫描**：逐个读取目标文件的**完整内容**。
4.  **逐行匹配**：将文件内容按行分割，对每一行进行匹配检查。
5.  **结果收集**：一旦发现匹配项，记录以下信息：
    *   `path`: 文件路径
    *   `line`: 行号
    *   `column`: 列号
    *   `preview`: 该行内容的预览（截取前 200 个字符）

## 2. 如何规定输入的关键词

关键词通过 `pattern` 参数传入。

### 参数说明

| 参数名 | 类型 | 必填 | 说明 |
| :--- | :--- | :--- | :--- |
| `pattern` | string | **是** | 要搜索的字符串或正则表达式。不能为空。 |
| `path` | string | **是** | 文件路径或 glob 模式（例如 `src/**/*.ts`）。 |
| `regex` | boolean | 否 | 是否将 `pattern` 视为正则表达式。默认为 `false`。 |
| `case_sensitive` | boolean | 否 | 是否区分大小写。默认为 `true`。 |
| `max_results` | number | 否 | 最大返回结果数。默认为 200。 |

### 输入示例

*   **精确搜索**：查找所有包含 "TODO" 的地方。
    *   `pattern`: "TODO"
    *   `regex`: false
*   **正则搜索**：查找所有 `function` 定义。
    *   `pattern`: "function\\s+\\w+\\("
    *   `regex`: true
*   **忽略大小写**：查找 "error"，不管写成 "Error" 还是 "ERROR"。
    *   `pattern`: "error"
    *   `case_sensitive`: false

## 3. 搜索范围：内容还是标题？

**明确结论：`fs_grep` 搜索的是【文件内容】。**

*   它会打开每一个匹配到的文件，读取其中的文本，然后逐行查找你的关键词。
*   它**不会**仅仅因为文件名包含关键词就返回结果（除非文件内容里也恰好有）。
*   **文件名筛选**是通过 `path` 参数进行的。如果你只想在特定名称的文件中搜索（例如只在 `.ts` 文件中搜），你应该在 `path` 中指定（如 `**/*.ts`）。

## 4. 最佳实践

1.  **先缩小范围**：尽量使用精确的 `path` Glob 模式（如 `src/components/**/*.vue`），避免在全项目（`**/*`）中搜索，这样效率更高，结果更相关。
2.  **善用正则**：当需要查找特定代码结构（如特定函数的调用）时，正则表达式非常强大。
3.  **注意转义**：如果使用正则模式，确保存入 JSON 时对反斜杠进行了正确的转义（例如 `\d` 要写成 `\\d`）。
