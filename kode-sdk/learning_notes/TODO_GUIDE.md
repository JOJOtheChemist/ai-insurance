# TODO 工具详解

TODO 系统是 Agent 用于**任务规划**、**进度跟踪**和**自我管理**的核心组件。它不是一个简单的文件读写工具，而是集成在 Agent 核心逻辑中的状态管理服务。

## 1. 为什么需要 TODO 系统？

对于复杂的任务（例如重构一个模块、实现一个新功能），LLM 很难在一个回合内完成。它需要：
1.  **拆解任务**：把大目标分解为小步骤。
2.  **记住进度**：知道哪些做了，哪些没做。
3.  **防止迷失**：在处理长上下文时，避免忘记最初的目标。
4.  **聚焦当前**：明确当前正在进行的唯一任务（`in_progress`）。

## 2. 工具介绍

TODO 系统主要包含两个工具：

### 2.1 `todo_read`
*   **功能**：读取当前的 TODO 列表。
*   **返回**：一个包含所有任务详情的数组。
*   **用途**：Agent 在开始工作前，通常会先调用它来确认“我接下来该做什么”。

### 2.2 `todo_write`
*   **功能**：**全量更新** TODO 列表。
*   **参数**：`todos: TodoItem[]`。
*   **用途**：
    *   **初始化**：创建最初的任务计划。
    *   **更新状态**：把某个任务标记为 `completed`，把下一个标记为 `in_progress`。
    *   **调整计划**：如果在执行中发现新问题，可以动态增加或修改任务。

## 3. TODO 数据结构

每个任务项包含以下关键字段：

```typescript
interface TodoItem {
  id: string;          // 唯一ID (如 "1", "task_init")
  title: string;       // 任务描述
  status: 'pending' | 'in_progress' | 'completed'; // 状态
  notes?: string;      // 备注信息
}
```

## 4. 核心规则：单一焦点 (Single Focus)

SDK 强制执行一条重要规则：
**同一时间只能有一个任务处于 `in_progress` 状态。**

*   **目的**：强制 Agent 专注。LLM 如果试图同时做两件事，出错率会直线上升。
*   **验证**：`todo_write` 工具会在写入前检查，如果有多个 `in_progress`，会直接报错抛出异常。

## 5. 典型工作流

一个典型的复杂任务执行流程如下：

1.  **用户提问**：“帮我重构登录模块。”
2.  **Agent 思考**：这需要分步做。
3.  **Agent 调用 `todo_write`**：初始化计划。
    ```json
    {
      "todos": [
        { "id": "1", "title": "分析现有代码", "status": "in_progress" },
        { "id": "2", "title": "设计新接口", "status": "pending" },
        { "id": "3", "title": "实现代码", "status": "pending" }
      ]
    }
    ```
4.  **Agent 执行任务 1**：读取文件，分析代码。
5.  **Agent 调用 `todo_write`**：更新进度。
    ```json
    {
      "todos": [
        { "id": "1", "title": "分析现有代码", "status": "completed" },
        { "id": "2", "title": "设计新接口", "status": "in_progress" }, // 切换焦点
        { "id": "3", "title": "实现代码", "status": "pending" }
      ]
    }
    ```
6.  **循环执行**... 直到所有任务变更为 `completed`。

## 6. 最佳实践

1.  **粒度适中**：一个 TODO 最好对应 1-3 次工具调用就能完成的工作量。太细会浪费 Token（频繁读写 TODO），太粗容易迷失。
2.  **动态调整**：计划不是死的。如果 Agent 在执行中发现新 Bug，它应该通过 `todo_write` 在列表中插入一个新的 `pending` 任务来修复它，而不是忽视。
3.  **利用 Notes**：如果某个任务需要记录一些中间结果（比如“记得把端口号改成 8080”），可以写在 `notes` 字段里，作为给未来的自己的备忘录。
