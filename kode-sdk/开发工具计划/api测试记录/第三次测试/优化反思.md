# 第三次测试反思与下一步优化：Inspect 工具的按需查阅 (Lazy Loading)

## 1. 问题发现
在第三次测试中，我们发现 `inspect` 工具虽然返回了结构化的 `coverage` 数据，但**数据量过大**。
例如，查询 ID 40 的 `coverage` 时，返回了包含所有条款全文的巨型 JSON。这导致：
1.  **Token 浪费**：Agent 可能只需要看其中一条，却被迫接收了全文。
2.  **上下文污染**：过多的无关信息占用了 Context Window，可能挤掉之前的关键对话信息。

## 2. 优化思路：分级查阅 (Lazy Loading)

我们可以借鉴前端 "Lazy Loading" 的思想，将 `inspect` 改造为两步走模式。

### 核心机制
引入 `view` 参数（默认为 `full`，可选 `summary`）。

### 场景演示

#### 第一步：我们要看“有什么” (Summary Mode)
Agent 想要了解产品 ID 40 的保障大概有哪些，但不希望被全文刷屏。
**Request**:
```http
GET /api/tools/inspect?product_id=40&fields=coverage&view=summary
```

**Response** (Backend 仅返回 Keys):
```json
{
  "coverage_keys": [
    "意外身故保险金",
    "猝死保险金",
    "意外伤残保险金",
    "意外骨折医疗保险金",
    "意外医药费用补偿金"
  ]
}
```
*收益：Token 消耗减少 95% 以上。Agent 能够清晰地看到“菜单”。*

#### 第二步：我们要看“具体的某一条” (Detail Mode)
Agent 发现用户关心“猝死”，且菜单里确实有“猝死保险金”。
**Request**:
```http
GET /api/tools/inspect?product_id=40&fields=coverage.猝死保险金
```

**Response** (Backend 返回特定 Key 的 Value):
```json
{
  "coverage": {
    "猝死保险金": "在保险合同有效期内，若被保险人发生猝死，则本公司给付猝死保险金予身故保险金受益人。"
  }
}
```

## 3. 执行计划
1.  修改后端 `tool_inspect_product` 接口，支持 `view=summary` 参数。
2.  当检测到 `view=summary` 且字段内容为字典时，仅返回 `keys`。
3.  验证优化效果。
